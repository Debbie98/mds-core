{
  "type": "object",
  "properties": {
    "transaction_id": {
      "type": "string",
      "format": "uuid"
    },
    "provider_id": {
      "type": "string",
      "format": "uuid",
      "description": "What Provider is being charged for this transaction?"
    },
    "device_id": {
      "type": "string",
      "format": "uuid",
      "nullable": true
    },
    "timestamp": {
      "type": "integer",
      "minimum": 100000000000,
      "maximum": 99999999999999
    },
    "fee_type": {
      "type": "string",
      "enum": [
        "base_fee",
        "upgrade_fee",
        "congestion_fee",
        "trip_fee",
        "parking_fee",
        "reservation_fee",
        "distance_fee",
        "tolls_fee",
        "compliance_violation_fee"
      ]
    },
    "amount": {
      "type": "integer"
    },
    "receipt": {
      "type": "object",
      "properties": {
        "receipt_id": {
          "type": "string",
          "format": "uuid"
        },
        "timestamp": {
          "type": "integer",
          "minimum": 100000000000,
          "maximum": 99999999999999
        },
        "origin_url": {
          "description": "Where did this transaction originate?",
          "type": "string",
          "format": "uri",
          "example": "https://mds.coruscant.com/compliance/snapshot/c78280ff-4e58-4e30-afa9-d72673037799"
        },
        "receipt_details": {
          "type": "object",
          "required": [
            "type"
          ],
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "trip"
                },
                "trip_id": {
                  "type": "string",
                  "format": "uuid"
                },
                "start_timestamp": {
                  "type": "integer",
                  "minimum": 100000000000,
                  "maximum": 99999999999999
                },
                "end_timestamp": {
                  "type": "integer",
                  "minimum": 100000000000,
                  "maximum": 99999999999999
                },
                "start_geography_id": {
                  "type": "string",
                  "format": "uuid",
                  "nullable": true,
                  "default": null
                },
                "start_geography_type": {
                  "type": "string"
                },
                "end_geography_id": {
                  "type": "string",
                  "format": "uuid",
                  "nullable": true,
                  "default": null
                },
                "end_geography_type": {
                  "type": "string"
                },
                "duration": {
                  "type": "integer",
                  "nullable": true,
                  "default": null
                },
                "distance": {
                  "type": "number",
                  "format": "float",
                  "nullable": true,
                  "default": null
                },
                "trip_events": {
                  "type": "array",
                  "items": {
                    "$schema": "http://json-schema.org/draft-07/schema#",
                    "type": "object",
                    "if": {
                      "properties": {
                        "event_types": {
                          "type": "array",
                          "contains": {
                            "type": "string",
                            "enum": [
                              "trip_start",
                              "trip_end",
                              "trip_enter_jurisdiction",
                              "trip_leave_jurisdiction"
                            ]
                          }
                        }
                      }
                    },
                    "then": {
                      "properties": {
                        "trip_id": {
                          "type": "string",
                          "format": "uuid"
                        }
                      },
                      "required": [
                        "trip_id"
                      ]
                    },
                    "properties": {
                      "device_id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "provider_id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "timestamp": {
                        "type": "integer",
                        "minimum": 100000000000,
                        "maximum": 99999999999999
                      },
                      "annotation": {
                        "$schema": "http://json-schema.org/draft-07/schema#",
                        "type": "object",
                        "properties": {
                          "device_id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "timestamp": {
                            "type": "integer",
                            "minimum": 100000000000,
                            "maximum": 99999999999999
                          },
                          "vehicle_id": {
                            "type": "string"
                          },
                          "vehicle_type": {
                            "type": "string",
                            "enum": [
                              "car",
                              "bicycle",
                              "scooter",
                              "moped",
                              "other"
                            ]
                          },
                          "propulsion_types": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "enum": [
                                "human",
                                "electric",
                                "electric_assist",
                                "hybrid",
                                "combustion"
                              ]
                            }
                          },
                          "accessibility_options": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "enum": [
                                "wheelchair_accessible"
                              ]
                            }
                          },
                          "geography_ids": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "format": "uuid"
                            }
                          },
                          "geography_types": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "nullable": true,
                              "default": null
                            }
                          },
                          "latency_ms": {
                            "type": "integer"
                          },
                          "recorded": {
                            "type": "integer",
                            "minimum": 100000000000,
                            "maximum": 99999999999999
                          }
                        },
                        "required": [
                          "device_id",
                          "timestamp",
                          "vehicle_id",
                          "vehicle_type",
                          "propulsion_types",
                          "accessibility_options",
                          "geography_ids",
                          "geography_types",
                          "latency_ms"
                        ],
                        "nullable": true
                      },
                      "event_types": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "enum": [
                            "agency_drop_off",
                            "agency_pick_up",
                            "battery_charged",
                            "battery_low",
                            "comms_lost",
                            "comms_restored",
                            "compliance_pick_up",
                            "decommissioned",
                            "located",
                            "maintenance",
                            "maintenance_pick_up",
                            "missing",
                            "off_hours",
                            "on_hours",
                            "provider_drop_off",
                            "rebalance_pick_up",
                            "reservation_cancel",
                            "reservation_start",
                            "system_resume",
                            "system_suspend",
                            "trip_cancel",
                            "trip_end",
                            "trip_enter_jurisdiction",
                            "trip_leave_jurisdiction",
                            "trip_start",
                            "unspecified",
                            "maintenance_start",
                            "maintenance_end",
                            "driver_cancellation",
                            "enter_jurisdiction",
                            "leave_jurisdiction",
                            "passenger_cancellation",
                            "provider_cancellation",
                            "recommissioned",
                            "reservation_stop",
                            "service_end",
                            "service_start",
                            "trip_resume",
                            "trip_stop"
                          ]
                        },
                        "minItems": 1
                      },
                      "vehicle_state": {
                        "type": "string",
                        "enum": [
                          "available",
                          "elsewhere",
                          "non_operational",
                          "on_trip",
                          "removed",
                          "reserved",
                          "unknown",
                          "stopped"
                        ]
                      },
                      "telemetry": {
                        "$schema": "http://json-schema.org/draft-07/schema#",
                        "type": "object",
                        "properties": {
                          "device_id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "provider_id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "timestamp": {
                            "type": "integer",
                            "minimum": 100000000000,
                            "maximum": 99999999999999
                          },
                          "gps": {
                            "type": "object",
                            "properties": {
                              "lat": {
                                "type": "number",
                                "format": "float",
                                "minimum": -90,
                                "maximum": 90
                              },
                              "lng": {
                                "type": "number",
                                "format": "float",
                                "minimum": -180,
                                "maximum": 180
                              },
                              "altitude": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "heading": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null,
                                "minimum": 0,
                                "exclusiveMaximum": 360
                              },
                              "speed": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "accuracy": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "hdop": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "satellites": {
                                "type": "integer",
                                "nullable": true,
                                "default": null
                              }
                            },
                            "required": [
                              "lat",
                              "lng"
                            ]
                          },
                          "charge": {
                            "type": "number",
                            "format": "float",
                            "nullable": true,
                            "default": null,
                            "minimum": 0,
                            "maximum": 1
                          },
                          "stop_id": {
                            "type": "string",
                            "format": "uuid",
                            "nullable": true,
                            "default": null
                          }
                        },
                        "required": [
                          "device_id",
                          "provider_id",
                          "timestamp",
                          "gps"
                        ]
                      },
                      "trip_state": {
                        "type": "string",
                        "enum": [
                          "on_trip",
                          "reserved",
                          "stopped",
                          null
                        ],
                        "nullable": true,
                        "default": null
                      },
                      "trip_id": {
                        "type": "string",
                        "format": "uuid",
                        "nullable": true,
                        "default": null
                      },
                      "recorded": {
                        "type": "integer",
                        "minimum": 100000000000,
                        "maximum": 99999999999999
                      },
                      "telemetry_timestamp": {
                        "type": "integer",
                        "minimum": 100000000000,
                        "maximum": 99999999999999
                      }
                    },
                    "required": [
                      "device_id",
                      "provider_id",
                      "timestamp",
                      "event_types",
                      "vehicle_state",
                      "telemetry",
                      "recorded"
                    ]
                  }
                }
              },
              "required": [
                "type",
                "start_timestamp",
                "end_timestamp",
                "trip_events",
                "trip_id"
              ]
            },
            {
              "type": "object",
              "description": "Receipt details which provide a pointer to an MDS Compliance Violation.",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "compliance_violation"
                },
                "violation_id": {
                  "type": "string",
                  "format": "uuid"
                },
                "trip_id": {
                  "type": "string",
                  "format": "uuid",
                  "nullable": true,
                  "default": null
                },
                "policy_id": {
                  "type": "string",
                  "format": "uuid"
                }
              },
              "required": [
                "type",
                "violation_id"
              ]
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "curb_use"
                },
                "trip_id": {
                  "type": "string",
                  "format": "uuid"
                },
                "start_timestamp": {
                  "type": "integer",
                  "minimum": 100000000000,
                  "maximum": 99999999999999
                },
                "end_timestamp": {
                  "type": "integer",
                  "minimum": 100000000000,
                  "maximum": 99999999999999
                },
                "vehicle_type": {
                  "type": "string",
                  "enum": [
                    "car",
                    "bicycle",
                    "scooter",
                    "moped",
                    "other"
                  ]
                },
                "geography_id": {
                  "type": "string",
                  "format": "uuid",
                  "nullable": true
                },
                "duration": {
                  "type": "integer"
                },
                "trip_events": {
                  "type": "array",
                  "items": {
                    "$schema": "http://json-schema.org/draft-07/schema#",
                    "type": "object",
                    "if": {
                      "properties": {
                        "event_types": {
                          "type": "array",
                          "contains": {
                            "type": "string",
                            "enum": [
                              "trip_start",
                              "trip_end",
                              "trip_enter_jurisdiction",
                              "trip_leave_jurisdiction"
                            ]
                          }
                        }
                      }
                    },
                    "then": {
                      "properties": {
                        "trip_id": {
                          "type": "string",
                          "format": "uuid"
                        }
                      },
                      "required": [
                        "trip_id"
                      ]
                    },
                    "properties": {
                      "device_id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "provider_id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "timestamp": {
                        "type": "integer",
                        "minimum": 100000000000,
                        "maximum": 99999999999999
                      },
                      "annotation": {
                        "$schema": "http://json-schema.org/draft-07/schema#",
                        "type": "object",
                        "properties": {
                          "device_id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "timestamp": {
                            "type": "integer",
                            "minimum": 100000000000,
                            "maximum": 99999999999999
                          },
                          "vehicle_id": {
                            "type": "string"
                          },
                          "vehicle_type": {
                            "type": "string",
                            "enum": [
                              "car",
                              "bicycle",
                              "scooter",
                              "moped",
                              "other"
                            ]
                          },
                          "propulsion_types": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "enum": [
                                "human",
                                "electric",
                                "electric_assist",
                                "hybrid",
                                "combustion"
                              ]
                            }
                          },
                          "accessibility_options": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "enum": [
                                "wheelchair_accessible"
                              ]
                            }
                          },
                          "geography_ids": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "format": "uuid"
                            }
                          },
                          "geography_types": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "nullable": true,
                              "default": null
                            }
                          },
                          "latency_ms": {
                            "type": "integer"
                          },
                          "recorded": {
                            "type": "integer",
                            "minimum": 100000000000,
                            "maximum": 99999999999999
                          }
                        },
                        "required": [
                          "device_id",
                          "timestamp",
                          "vehicle_id",
                          "vehicle_type",
                          "propulsion_types",
                          "accessibility_options",
                          "geography_ids",
                          "geography_types",
                          "latency_ms"
                        ],
                        "nullable": true
                      },
                      "event_types": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "enum": [
                            "agency_drop_off",
                            "agency_pick_up",
                            "battery_charged",
                            "battery_low",
                            "comms_lost",
                            "comms_restored",
                            "compliance_pick_up",
                            "decommissioned",
                            "located",
                            "maintenance",
                            "maintenance_pick_up",
                            "missing",
                            "off_hours",
                            "on_hours",
                            "provider_drop_off",
                            "rebalance_pick_up",
                            "reservation_cancel",
                            "reservation_start",
                            "system_resume",
                            "system_suspend",
                            "trip_cancel",
                            "trip_end",
                            "trip_enter_jurisdiction",
                            "trip_leave_jurisdiction",
                            "trip_start",
                            "unspecified",
                            "maintenance_start",
                            "maintenance_end",
                            "driver_cancellation",
                            "enter_jurisdiction",
                            "leave_jurisdiction",
                            "passenger_cancellation",
                            "provider_cancellation",
                            "recommissioned",
                            "reservation_stop",
                            "service_end",
                            "service_start",
                            "trip_resume",
                            "trip_stop"
                          ]
                        },
                        "minItems": 1
                      },
                      "vehicle_state": {
                        "type": "string",
                        "enum": [
                          "available",
                          "elsewhere",
                          "non_operational",
                          "on_trip",
                          "removed",
                          "reserved",
                          "unknown",
                          "stopped"
                        ]
                      },
                      "telemetry": {
                        "$schema": "http://json-schema.org/draft-07/schema#",
                        "type": "object",
                        "properties": {
                          "device_id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "provider_id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "timestamp": {
                            "type": "integer",
                            "minimum": 100000000000,
                            "maximum": 99999999999999
                          },
                          "gps": {
                            "type": "object",
                            "properties": {
                              "lat": {
                                "type": "number",
                                "format": "float",
                                "minimum": -90,
                                "maximum": 90
                              },
                              "lng": {
                                "type": "number",
                                "format": "float",
                                "minimum": -180,
                                "maximum": 180
                              },
                              "altitude": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "heading": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null,
                                "minimum": 0,
                                "exclusiveMaximum": 360
                              },
                              "speed": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "accuracy": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "hdop": {
                                "type": "number",
                                "format": "float",
                                "nullable": true,
                                "default": null
                              },
                              "satellites": {
                                "type": "integer",
                                "nullable": true,
                                "default": null
                              }
                            },
                            "required": [
                              "lat",
                              "lng"
                            ]
                          },
                          "charge": {
                            "type": "number",
                            "format": "float",
                            "nullable": true,
                            "default": null,
                            "minimum": 0,
                            "maximum": 1
                          },
                          "stop_id": {
                            "type": "string",
                            "format": "uuid",
                            "nullable": true,
                            "default": null
                          }
                        },
                        "required": [
                          "device_id",
                          "provider_id",
                          "timestamp",
                          "gps"
                        ]
                      },
                      "trip_state": {
                        "type": "string",
                        "enum": [
                          "on_trip",
                          "reserved",
                          "stopped",
                          null
                        ],
                        "nullable": true,
                        "default": null
                      },
                      "trip_id": {
                        "type": "string",
                        "format": "uuid",
                        "nullable": true,
                        "default": null
                      },
                      "recorded": {
                        "type": "integer",
                        "minimum": 100000000000,
                        "maximum": 99999999999999
                      },
                      "telemetry_timestamp": {
                        "type": "integer",
                        "minimum": 100000000000,
                        "maximum": 99999999999999
                      }
                    },
                    "required": [
                      "device_id",
                      "provider_id",
                      "timestamp",
                      "event_types",
                      "vehicle_state",
                      "telemetry",
                      "recorded"
                    ]
                  }
                }
              },
              "required": [
                "type",
                "duration",
                "end_timestamp",
                "geography_id",
                "start_timestamp",
                "trip_events",
                "trip_id",
                "vehicle_type"
              ]
            },
            {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "custom"
                },
                "custom_description": {
                  "type": "string"
                }
              },
              "required": [
                "type",
                "custom_description"
              ]
            }
          ]
        }
      },
      "required": [
        "origin_url",
        "receipt_details",
        "receipt_id",
        "timestamp"
      ]
    }
  },
  "required": [
    "amount",
    "device_id",
    "fee_type",
    "provider_id",
    "receipt",
    "timestamp",
    "transaction_id"
  ]
}